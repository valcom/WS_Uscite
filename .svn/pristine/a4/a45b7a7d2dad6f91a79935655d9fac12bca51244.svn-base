/**
 * 
 */
package it.ccse.uscite.facade;

import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

import it.ccse.uscite.application.facade.WS_UsciteFacade;
import it.ccse.uscite.application.facade.dto.ComitatoDTO;
import it.ccse.uscite.application.facade.dto.DettaglioComitatoDTO;
import it.ccse.uscite.application.facade.dto.DettaglioNotaPagamentoDTO;
import it.ccse.uscite.application.facade.dto.PraticaErogazioneDTO;
import it.ccse.uscite.application.facade.dto.SettoreAttivitaDTO;
import it.ccse.uscite.application.facade.dto.input.AggiornaComitato_InDTO;
import it.ccse.uscite.application.facade.dto.input.AggiornaNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.AggiornaSemaforiAnagrafica_InDTO;
import it.ccse.uscite.application.facade.dto.input.AggiungiComitato_InDTO;
import it.ccse.uscite.application.facade.dto.input.AggiungiNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.ApriComitato_InDTO;
import it.ccse.uscite.application.facade.dto.input.ApriNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.ChiudiComitato_InDTO;
import it.ccse.uscite.application.facade.dto.input.ChiudiNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.EliminaComitato_InDTO;
import it.ccse.uscite.application.facade.dto.input.EliminaNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetComitatiAutorizzabili_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetComitati_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetNoteByComitato_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetNoteInLavorazione_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetNoteLavorabili_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetNoteLavorate_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetPraticheByNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.GetPraticheLavorabili_InDTO;
import it.ccse.uscite.application.facade.dto.input.LavorazioneContabileNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.LavorazioneContabilePratica_InDTO;
import it.ccse.uscite.application.facade.dto.input.RinviaNota_InDTO;
import it.ccse.uscite.application.facade.dto.input.SearchPraticheInSospeso_InDTO;
import it.ccse.uscite.application.facade.dto.input.SearchPratiche_InDTO;
import it.ccse.uscite.application.facade.dto.output.AggiornaComitato_OutDTO;
import it.ccse.uscite.application.facade.dto.output.AggiornaNota_OutDTO;
import it.ccse.uscite.application.facade.dto.output.AggiornaSemaforiAnagrafica_OutDTO;
import it.ccse.uscite.application.facade.dto.output.AggiungiNota_OutDTO;
import it.ccse.uscite.application.facade.dto.output.ApriComitato_OutDTO;
import it.ccse.uscite.application.facade.dto.output.ApriNota_OutDTO;
import it.ccse.uscite.application.facade.dto.output.ChiudiComitato_OutDTO;
import it.ccse.uscite.application.facade.dto.output.ChiudiNota_OutDTO;
import it.ccse.uscite.application.facade.dto.output.EliminaComitato_OutDTO;
import it.ccse.uscite.application.facade.dto.output.EliminaNota_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetComitatiAutorizzabili_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetComitati_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetNoteByComitato_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetNoteInLavorazione_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetNoteLavorabili_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetNoteLavorate_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetPraticheByNota_OutDTO;
import it.ccse.uscite.application.facade.dto.output.GetPraticheLavorabili_OutDTO;
import it.ccse.uscite.application.facade.dto.output.LavorazioneContabile_OutDTO;
import it.ccse.uscite.application.facade.dto.output.RinviaNota_OutDTO;
import it.ccse.uscite.application.facade.dto.output.SearchPraticheInSospeso_OutDTO;
import it.ccse.uscite.application.facade.dto.output.SearchPratiche_OutDTO;
import it.ccse.uscite.application.facade.dto.output.Base_OutDTO.Esito;
import it.ccse.uscite.domain.OrdineDelGiorno.TipologiaComitato;
import it.ccse.uscite.domain.SettoreAttivita.StatoAntimafia;
import it.ccse.uscite.domain.SettoreAttivita.Unbundling;

import org.apache.commons.lang3.time.DateUtils;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.context.web.WebAppConfiguration;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.context.request.RequestAttributes;
import org.springframework.web.context.request.RequestContextHolder;

/**
 * @author vcompagnone
 *
 */
@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
@ContextConfiguration(locations =  {"file:src/main/webapp/WEB-INF/application-context.xml","classpath:/spring/datasource.xml","classpath:/spring/mail.xml"} )
@Transactional
public class WS_UsciteFacadeTest {
	@Autowired
	private WS_UsciteFacade wsUsciteFacade;
	
	@Test
	public void testSearchPratiche(){
		SearchPratiche_InDTO searchPratiche_InDTO = new SearchPratiche_InDTO();
		
		searchPratiche_InDTO.setAnnoDa(2014);
		searchPratiche_InDTO.setAnnoA(2014);
//		List<Integer> listaIdSettoreAttivita = new ArrayList<Integer>();
//		listaIdSettoreAttivita.add(1261);
//		listaIdSettoreAttivita.add(1264);
//		listaIdSettoreAttivita.add(1401);
		searchPratiche_InDTO.setPageSize(100);
		searchPratiche_InDTO.setPageNumber(2);
		//searchPratiche_InDTO.setListaIdSettoreAttivita(listaIdSettoreAttivita );;
		
		SearchPratiche_OutDTO output = wsUsciteFacade.searchPratiche(searchPratiche_InDTO);
		
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS);
	}
	@Test
	public void testGetOrdiniDelGiorno(){
		GetComitati_InDTO inputDTO = new GetComitati_InDTO();
		GetComitati_OutDTO output = wsUsciteFacade.getComitati(inputDTO );
		List<DettaglioComitatoDTO> listaComitati = output.getContent();
		Assert.assertNotNull(listaComitati);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS);
	}
	
	@Test
	public void testAddOrdineDelGiorno(){
		String descrizione = "prova";
		Integer numeroComitato = 1;
		TipologiaComitato tipologia = TipologiaComitato.ORDINARIO;
		Date dataComitato = DateUtils.truncate(DateUtils.addDays(new Date(),100),Calendar.DAY_OF_MONTH);
		AggiungiComitato_InDTO ordineDelGiorno_InDTO = new AggiungiComitato_InDTO();
		ordineDelGiorno_InDTO.setDataComitato(dataComitato);
		ordineDelGiorno_InDTO.setDescrizione(descrizione);
		ordineDelGiorno_InDTO.setNumeroComitato(numeroComitato);
		ordineDelGiorno_InDTO.setTipologia(tipologia);
		ComitatoDTO ordine = wsUsciteFacade.aggiungiComitato(ordineDelGiorno_InDTO).getContent();
		Assert.assertNotNull(ordine);
		Assert.assertEquals(dataComitato,ordine.getDataComitato());
		Assert.assertEquals(numeroComitato,ordine.getNumeroComitato());
		Assert.assertEquals(tipologia,ordine.getTipologia());
		Assert.assertEquals(descrizione,ordine.getDescrizione());
	}
	
	@Test
	public void testDeleteOrdineDelGiorno(){
		EliminaComitato_InDTO deleteOrdineDelGiorno_InDTO = new EliminaComitato_InDTO();
		GetComitati_InDTO inputDTO = new GetComitati_InDTO();
		List<DettaglioComitatoDTO> listaComitati =  wsUsciteFacade.getComitati(inputDTO ).getContent();
		deleteOrdineDelGiorno_InDTO.setIdOrdineDelGiorno(listaComitati.get(0).getId());
		EliminaComitato_OutDTO output = wsUsciteFacade.deleteComitato(deleteOrdineDelGiorno_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS);
	}
	
	@Test
	public void testApriOrdineDelGiorno(){
		ApriComitato_InDTO apriOrdineDelGiorno_InDTO = new ApriComitato_InDTO();
		GetComitati_InDTO inputDTO = new GetComitati_InDTO();
		List<DettaglioComitatoDTO> listaComitati =  wsUsciteFacade.getComitati(inputDTO ).getContent();
		apriOrdineDelGiorno_InDTO.setIdOrdineDelGiorno(listaComitati.get(0).getId());
		ApriComitato_OutDTO output = wsUsciteFacade.apriComitato(apriOrdineDelGiorno_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
	}
	
	@Test
	public void testChiudiOrdineDelGiorno(){
		ChiudiComitato_InDTO chiudiOrdineDelGiorno_InDTO = new ChiudiComitato_InDTO();
		GetComitati_InDTO inputDTO = new GetComitati_InDTO();
		List<DettaglioComitatoDTO> listaComitati =  wsUsciteFacade.getComitati(inputDTO ).getContent();
		chiudiOrdineDelGiorno_InDTO.setIdOrdineDelGiorno(listaComitati.get(0).getId());
		ChiudiComitato_OutDTO output = wsUsciteFacade.chiudiComitato(chiudiOrdineDelGiorno_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
	}
	
	@Test
	public void testUpdateOrdineDelGiorno(){
		String descrizione = "pippo";
		Date dataComitato = DateUtils.addDays(new Date(), 2);
		AggiornaComitato_InDTO updateOrdineDelGiorno_InDTO = new AggiornaComitato_InDTO();
		GetComitati_InDTO inputDTO = new GetComitati_InDTO();
		List<DettaglioComitatoDTO> listaComitati =  wsUsciteFacade.getComitati(inputDTO ).getContent();
		updateOrdineDelGiorno_InDTO.setIdOrdineDelGiorno(listaComitati.get(0).getId());
		updateOrdineDelGiorno_InDTO.setDataComitato(dataComitato);
		
		updateOrdineDelGiorno_InDTO.setDescrizione(descrizione);
		AggiornaComitato_OutDTO output = wsUsciteFacade.aggiornaComitato(updateOrdineDelGiorno_InDTO);
		//ComitatoDTO ordine = output.getContent();
	//	Assert.assertNotNull(ordine);
		//Assert.assertEquals(descrizione, ordine.getDescrizione());
		//Assert.assertEquals(dataComitato, ordine.getDataComitato());
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
	}
	
	@Test
	public void testAggiungiNota(){
		String causale = "pippo";
		Integer numeroNota = 2;
		Integer idOrdine = wsUsciteFacade.getComitati(new GetComitati_InDTO()).getContent().get(0).getId();
		String idUnita = "PC";
		String username = "topogigio";
		ComitatoDTO ordine = new ComitatoDTO(); 
		ordine.setId(idOrdine);
		
		AggiungiNota_InDTO aggiungiNotaDTO_InDTO = new AggiungiNota_InDTO();
		
		aggiungiNotaDTO_InDTO.setCausale(causale);
		aggiungiNotaDTO_InDTO.setNumeroNota(numeroNota);
		aggiungiNotaDTO_InDTO.setUsername(username);
		aggiungiNotaDTO_InDTO.setOwner(idUnita);
		
		aggiungiNotaDTO_InDTO.setOrdineDelGiorno(ordine);
		AggiungiNota_OutDTO output = wsUsciteFacade.aggiungiNota(aggiungiNotaDTO_InDTO);
		DettaglioNotaPagamentoDTO nota = output.getContent();
		Assert.assertNotNull(nota);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS);
		Assert.assertEquals(causale,nota.getCausale());
		Assert.assertEquals(numeroNota,nota.getNumeroNota());
		Assert.assertEquals(idOrdine,nota.getOrdineDelGiorno().getId());
		Assert.assertEquals(idUnita,nota.getOwner());
		Assert.assertEquals(username,RequestContextHolder.currentRequestAttributes().getAttribute("username",RequestAttributes.SCOPE_REQUEST));
	}

	@Test
	public void testEliminaNota(){
		EliminaNota_InDTO eliminaNota_InDTO = new EliminaNota_InDTO();
		Integer id = 35;
		eliminaNota_InDTO.setIdProcessoErogazione(id);
		EliminaNota_OutDTO output = wsUsciteFacade.eliminaNota(eliminaNota_InDTO);
		
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
	}
	
	@Test
	public void testAggiornaNota(){
		String causale = "pippo";
		Integer numeroNota = 32;
		Integer id = 414;
		AggiornaNota_InDTO aggiornaNota_InDTO = new AggiornaNota_InDTO();
		aggiornaNota_InDTO.setIdNota(id);
		aggiornaNota_InDTO.setCausale(causale);
		aggiornaNota_InDTO.setNumeroNota(numeroNota);
		AggiornaNota_OutDTO output = wsUsciteFacade.aggiornaNota(aggiornaNota_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
		
	}
	
	@Test
	public void testApriNota(){
		Integer id = 414;
		ApriNota_InDTO apriNotaInDTO = new ApriNota_InDTO();
		apriNotaInDTO.setIdProcessoErogazione(id);
		ApriNota_OutDTO output = wsUsciteFacade.apriNota(apriNotaInDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);

	}
	
	@Test
	public void testChiudiNota(){
		Integer id = 414; 
		ChiudiNota_InDTO chiudiNotaInDTO = new ChiudiNota_InDTO();
		chiudiNotaInDTO.setIdProcessoErogazione(id);
		ChiudiNota_OutDTO output = wsUsciteFacade.chiudiNota(chiudiNotaInDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);

	}

	@Test
	public void testGetNoteByComitato(){
		Integer idComitato = 49;
		GetNoteByComitato_InDTO getNoteByComitato_InDTO = new GetNoteByComitato_InDTO();
		getNoteByComitato_InDTO.setIdOrdineDelGiorno(idComitato);
		GetNoteByComitato_OutDTO output = wsUsciteFacade.getNoteByComitato(getNoteByComitato_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
	}
	
	@Test
	public void testRinviaNota(){
		RinviaNota_InDTO rinviaNota_InDTO = new RinviaNota_InDTO();
		String username = "pippo";
		Integer idComitato = 49;
		Integer idNota = 413;
		rinviaNota_InDTO.setIdComitato(idComitato);
		rinviaNota_InDTO.setIdNota(idNota);
		rinviaNota_InDTO.setUsername(username);
		RinviaNota_OutDTO output = wsUsciteFacade.rinviaNota(rinviaNota_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
	}
	
	@Test
	public void testGetPraticheByNota(){
		GetPraticheByNota_InDTO getPraticheByNota_InDTO = new GetPraticheByNota_InDTO();
		Integer idProcessoErogazione = 390;//401;//390;
		getPraticheByNota_InDTO.setIdProcessoErogazione(idProcessoErogazione );
		GetPraticheByNota_OutDTO output = wsUsciteFacade.getPraticheByNota(getPraticheByNota_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);
	}
	
	@Test
	public void testGetNoteInLavorazione(){
		GetNoteInLavorazione_InDTO getNoteInLavorazione_InDTO = new GetNoteInLavorazione_InDTO();
		Integer idOrdineDelGiorno = 49;
		getNoteInLavorazione_InDTO.setIdOrdineDelGiorno(idOrdineDelGiorno );
		GetNoteInLavorazione_OutDTO output = wsUsciteFacade.getNoteInLavorazione(getNoteInLavorazione_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		
	}
	
	@Test
	public void testGetNoteLavorate(){
		Integer idOrdineDelGiorno = 43;
		GetNoteLavorate_InDTO getNoteLavorate_InDTO = new GetNoteLavorate_InDTO();
		getNoteLavorate_InDTO.setIdOrdineDelGiorno(idOrdineDelGiorno);
		GetNoteLavorate_OutDTO output = wsUsciteFacade.getNoteLavorate(getNoteLavorate_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		
	}
	
	@Test
	public void testGetNoteLavorabili(){
		GetNoteLavorabili_InDTO getNoteLavorabili_InDTO = new GetNoteLavorabili_InDTO();
		Integer idOrdineDelgiorno = 43;
		getNoteLavorabili_InDTO.setIdOrdineDelGiorno(idOrdineDelgiorno);
		GetNoteLavorabili_OutDTO output = wsUsciteFacade.getGetNoteLavorabili(getNoteLavorabili_InDTO );
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		

	}
	
	@Test
	public void testGetPraticheLavorabili(){
		GetPraticheLavorabili_InDTO getPraticheLavorabili_InDTO = new GetPraticheLavorabili_InDTO();
		Integer idProcessoErogazione = 390;
		getPraticheLavorabili_InDTO.setIdProcessoErogazione(idProcessoErogazione );
		GetPraticheLavorabili_OutDTO output = wsUsciteFacade.getPraticheLavorabili(getPraticheLavorabili_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		
	}
	
	@Test
	public void testGetOrdiniDelGiornoAutorizzabili(){
		GetComitatiAutorizzabili_InDTO getOrdiniDelGiornoAutorizzabiliInDTO = new GetComitatiAutorizzabili_InDTO();
		GetComitatiAutorizzabili_OutDTO output = wsUsciteFacade.getComitatiAutorizzabili(getOrdiniDelGiornoAutorizzabiliInDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		
	}
	
	@Test
	public void testLavorazioneContabileNota(){
		LavorazioneContabileNota_InDTO lavorazioneContabileNota_InDTO = new LavorazioneContabileNota_InDTO();
		Integer idNota = 390;
		lavorazioneContabileNota_InDTO.setIdNota(idNota);
		LavorazioneContabile_OutDTO output = wsUsciteFacade.lavorazioneContabileNota(lavorazioneContabileNota_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		
	}
	
	
	@Test
	public void testLavorazioneContabilePratiche(){
		LavorazioneContabilePratica_InDTO lavorazioneContabilePratica_InDTO = new LavorazioneContabilePratica_InDTO();
		List<PraticaErogazioneDTO> content = new ArrayList<PraticaErogazioneDTO>();
		PraticaErogazioneDTO pratica1 = new PraticaErogazioneDTO();
		pratica1.setId(2410);
		PraticaErogazioneDTO pratica2 = new PraticaErogazioneDTO();
		pratica2.setId(2411);
		PraticaErogazioneDTO pratica3 = new PraticaErogazioneDTO();
		pratica3.setId(2412);
		PraticaErogazioneDTO pratica4 = new PraticaErogazioneDTO();
		pratica4.setId(4383);
		PraticaErogazioneDTO pratica5 = new PraticaErogazioneDTO();
		pratica5.setId(12734);	
		content.add(pratica1);
		content.add(pratica2);
		content.add(pratica3);
		content.add(pratica4);
		content.add(pratica5);
		lavorazioneContabilePratica_InDTO.setContent(content);
		LavorazioneContabile_OutDTO output = wsUsciteFacade.lavorazioneContabilePratiche(lavorazioneContabilePratica_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		
	}
	
	@Test
	public void testAggiornaSemaforiAnagrafica(){
		
		AggiornaSemaforiAnagrafica_InDTO aggiornaSemaforiAnagrafica_InDTO = new AggiornaSemaforiAnagrafica_InDTO();
		
		List<SettoreAttivitaDTO> content = new ArrayList<SettoreAttivitaDTO>();
		
		SettoreAttivitaDTO settore1 = new SettoreAttivitaDTO();
		settore1.setId(1074);
		settore1.setStatoAntimafia(StatoAntimafia.CERTIFICATO_VALIDO );
		content.add(settore1);
		SettoreAttivitaDTO settore2 = new SettoreAttivitaDTO();
		settore2.setId(173);
		settore2.setUnbundling(Unbundling.SBLOCCATA);
		content.add(settore2);
		aggiornaSemaforiAnagrafica_InDTO.setContent(content );
		
		AggiornaSemaforiAnagrafica_OutDTO output = wsUsciteFacade.aggiornaSemaforiAnagrafica(aggiornaSemaforiAnagrafica_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		

	}
	
	@Test
	public void testSearchSospesi(){
		SearchPraticheInSospeso_InDTO searchPraticheInSospeso_InDTO = new SearchPraticheInSospeso_InDTO();
		searchPraticheInSospeso_InDTO.setAnnoDa(2014);
		searchPraticheInSospeso_InDTO.setAnnoA(2014);
		searchPraticheInSospeso_InDTO.setErogabile(false);
		SearchPraticheInSospeso_OutDTO output = wsUsciteFacade.searchPraticheInSospeso(searchPraticheInSospeso_InDTO);
		Assert.assertTrue(output.getEsito() == Esito.SUCCESS || output.getEsito() == Esito.APPLICATION_ERROR);		
	}
}
